<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SS14 Chemistry</title>
    <style>
        :root {
            --bg-color: #1e1e24;
            --card-bg: #2b2b36;
            --border: #3f3f4e;
            --text-main: #e0e0e0;
            --text-muted: #a0a0b0;
            --accent: #5e81ac;
            --heat: #bf616a;
            --cold: #88c0d0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        header {
            max-width: 1200px;
            margin: 0 auto 30px;
            text-align: center;
        }

        h1 { margin-bottom: 10px; font-weight: 300; letter-spacing: 1px; }

        #search-container {
            position: sticky;
            top: 20px;
            z-index: 100;
            background: var(--bg-color);
            padding: 10px 0;
            box-shadow: 0 10px 20px -10px rgba(0,0,0,0.5);
        }

        input#search {
            width: 100%;
            max-width: 600px;
            padding: 15px;
            font-size: 16px;
            background: var(--card-bg);
            border: 2px solid var(--border);
            color: white;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.2s;
        }
        input#search:focus { border-color: var(--accent); }

        #app {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .card-header {
            background: rgba(0,0,0,0.2);
            padding: 12px 15px;
            font-size: 18px;
            font-weight: bold;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-body {
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .column { flex: 1; }
        .arrow-column { flex: 0 0 30px; text-align: center; color: var(--text-muted); font-size: 20px; }

        .reagent-list { list-style: none; padding: 0; margin: 0; font-size: 14px; }
        .reagent-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            background: rgba(255,255,255,0.03);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .beaker-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.3);
            margin-right: 8px;
            flex-shrink: 0;
            box-shadow: inset 0 0 4px rgba(0,0,0,0.5);
        }

        .section-label {
            font-size: 11px;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 5px;
            display: block;
            letter-spacing: 0.5px;
        }

        .condition-badge {
            display: inline-block;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 4px;
            font-weight: bold;
        }
        .cond-heat { background: rgba(191, 97, 106, 0.2); color: #bf616a; border: 1px solid #bf616a; }
        .cond-cold { background: rgba(136, 192, 208, 0.2); color: #88c0d0; border: 1px solid #88c0d0; }

        .error-box { grid-column: 1 / -1; text-align: center; padding: 40px; color: #bf616a; border: 1px dashed #bf616a; }

        .recipe-desc {
            padding: 10px 15px 0;
            font-size: 13px;
            color: var(--text-muted);
            font-style: italic;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            padding-bottom: 10px;
        }

        .meta-tag {
            display: inline-block;
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
            font-size: 10px;
        }

        .overdose-warning {
            color: #bf616a;
            font-weight: bold;
            font-size: 11px;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>

    <header>
        <h1>SS14 Chemistry Cookbook</h1>
        <div id="search-container">
            <input type="text" id="search" placeholder="Search for chemicals (e.g. 'Bicaridine', 'Diphenhydramine')..." onkeyup="render()">
        </div>
    </header>

    <div id="app">Loading database...</div>

    <script>
        let recipes = [];

        async function init() {
            try {
                const response = await fetch('chem_data.json?t=' + Date.now());
                if (!response.ok) throw new Error(`Status ${response.status}`);
                recipes = await response.json();
                render();
            } catch (e) {
                document.getElementById('app').innerHTML = `<div class="error-box">Could not load recipes.<br>${e.message}</div>`;
            }
        }

        function render() {
            const query = document.getElementById('search').value.toLowerCase();
            const container = document.getElementById('app');
            
            // Safety Check Filter
            const filtered = recipes.filter(r => 
                r.products && r.products.length > 0 && 
                (
                    r.id.toLowerCase().includes(query) || 
                    r.products.some(p => p.name && p.name.toLowerCase().includes(query))
                )
            );

            if (filtered.length === 0) {
                container.innerHTML = `<div style="grid-column: 1/-1; text-align:center; color:#666;">No matches found.</div>`;
                return;
            }

            container.innerHTML = filtered.map(r => {
                const mainP = r.products[0];
                
                let conditionsHtml = '';
                if (r.conditions.minTemp) conditionsHtml += `<div class="condition-badge cond-heat">Min: ${Math.round(r.conditions.minTemp)}K</div>`;
                if (r.conditions.maxTemp) conditionsHtml += `<div class="condition-badge cond-cold">Max: ${Math.round(r.conditions.maxTemp)}K</div>`;

                let tagsHtml = mainP.tags.map(t => `<span class="meta-tag">${t}</span>`).join('');
                
                let overdoseHtml = mainP.overdose ? `<span class="overdose-warning">OD: ${mainP.overdose}u</span>` : '';

                let descHtml = mainP.desc ? `<div class="recipe-desc">${mainP.desc}</div>` : '';

                return `
                <div class="card">
                    <div class="card-header">
                        <div style="display:flex; flex-direction:column; gap:4px;">
                            <div style="display:flex; justify-content:space-between; width:100%;">
                                <span>${mainP.name}</span>
                                <div style="font-size:12px;">${tagsHtml}</div>
                            </div>
                            <div style="font-size:12px; font-weight:normal; opacity:0.8;">${overdoseHtml}</div>
                        </div>
                    </div>
                    
                    ${descHtml} <div class="card-body">
                        <div class="column">
                            <span class="section-label">Mix</span>
                            <ul class="reagent-list">
                                ${r.reactants.map(i => `
                                    <li class="reagent-item">
                                        <span class="beaker-dot" style="background-color: ${i.color}"></span>
                                        ${i.amount}u ${i.name}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>

                        <div class="arrow-column">
                            âž”
                            ${conditionsHtml}
                        </div>

                        <div class="column">
                            <span class="section-label">Result</span>
                            <ul class="reagent-list">
                                ${r.products.map(p => `
                                    <li class="reagent-item">
                                        <span class="beaker-dot" style="background-color: ${p.color}"></span>
                                        ${p.amount}u ${p.name}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        init();
    </script>
</body>
</html>